#include <windows.h>
#include <cstdio>
#include <iostream>

/*

DWORD temp;
–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —á—Ç–µ–Ω–∏—è ‚Äî 32-–±–∏—Ç–Ω–æ–µ –±–µ–∑–∑–Ω–∞–∫–æ–≤–æ–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ (—Ç–∏–ø DWORD = unsigned long).

SIZE_T read;
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –±–∞–π—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–µ–π ReadProcessMemory.

uintptr_t address = 0x00000049CADAFB84;
–£–∫–∞–∑–∞–Ω–∏–µ 64-–±–∏—Ç–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞ –ø–∞–º—è—Ç–∏ (—á—Ç–æ –≤–∞–∂–Ω–æ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å x64 –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏). –¢–∏–ø uintptr_t –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ–¥ —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ (x64 –∑–¥–µ—Å—å).


üîπ –ß—Ç–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –¥—Ä—É–≥–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞:

ReadProcessMemory(process, reinterpret_cast<LPVOID>(address), &temp, sizeof(temp), &read);
process ‚Äî –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ä–∞–Ω–µ–µ —á–µ—Ä–µ–∑ OpenProcess().

reinterpret_cast<LPVOID>(address) ‚Äî –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ –∫ —Ç–∏–ø—É —É–∫–∞–∑–∞—Ç–µ–ª—è –Ω–∞ void.

&temp ‚Äî —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é, –∫—É–¥–∞ –±—É–¥–µ—Ç –∑–∞–ø–∏—Å–∞–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ.

sizeof(temp) ‚Äî —Ä–∞–∑–º–µ—Ä —á–∏—Ç–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö (4 –±–∞–π—Ç–∞).

&read ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, –≤ –∫–æ—Ç–æ—Ä—É—é –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –±–∞–π—Ç–æ–≤.

üìå –ï—Å–ª–∏ –≤—Å—ë –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ, —Ç–æ temp —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –ø–∞–º—è—Ç–∏ –ø–æ –∞–¥—Ä–µ—Å—É 0x49CADAFB84.

wchar_t buffer[64]; ‚Äî —Å–æ–∑–¥–∞—ë—Ç—Å—è –±—É—Ñ–µ—Ä –¥–ª—è —Å—Ç—Ä–æ–∫–∏ (Unicode).

swprintf_s(...) ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–ø–æ—Å–æ–± —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–æ–∫–∏, –∞–Ω–∞–ª–æ–≥ sprintf, –Ω–æ —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –Ω–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ.

–§–æ—Ä–º–∞—Ç L"–ó–Ω
–∞—á–µ–Ω–∏–µ: %u" —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫—É –±–µ–∑–∑–Ω–∞–∫–æ–≤–æ–≥–æ —Ü–µ–ª–æ–≥–æ (temp) –≤ Unicode-—Å—Ç—Ä–æ–∫—É.


üîπ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç swprintf_s?
–≠—Ç–æ —Ç–∞–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–º–æ–≥–∞–µ—Ç —Å–æ–±—Ä–∞—Ç—å —Å—Ç—Ä–æ–∫—É –∏–∑ –∫—É—Å–æ—á–∫–æ–≤ ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å –Ω–∞–ø–∏—Å–∞—Ç—å:

¬´–£ –º–µ–Ω—è –µ—Å—Ç—å 5 –∫–æ–Ω—Ñ–µ—Ç¬ª

...–Ω–æ —á–∏—Å–ª–æ 5 ‚Äî —ç—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, –∞ –Ω–µ –∑–∞—Ä–∞–Ω–µ–µ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç.


—Å—Ç—Ä–æ–∫–∞[100] ‚Äî —ç—Ç–æ –∫–∞–∫ –ø—É—Å—Ç–∞—è –∫–æ—Ä–æ–±–∫–∞, –≤ –∫–æ—Ç–æ—Ä—É—é –º—ã —Ö–æ—Ç–∏–º –ø–æ–ª–æ–∂–∏—Ç—å —Ç–µ–∫—Å—Ç.

L"–£ –º–µ–Ω—è –µ—Å—Ç—å %d –∫–æ–Ω—Ñ–µ—Ç" ‚Äî —ç—Ç–æ —à–∞–±–ª–æ–Ω, –≤ –∫–æ—Ç–æ—Ä–æ–º %d ‚Äî —ç—Ç–æ –º–µ—Å—Ç–æ –¥–ª—è —á–∏—Å–ª–∞.

–∫–æ–Ω—Ñ–µ—Ç—ã ‚Äî —ç—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, –∫–æ—Ç–æ—Ä—É—é –º—ã –ø–æ–¥—Å—Ç–∞–≤–∏–º –≤–º–µ—Å—Ç–æ %d.

swprintf_s ‚Äî —ç—Ç–æ "—É–º–Ω—ã–π –º–∞—Ä–∫–µ—Ä", –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —á–∏—Å–ª–æ –Ω–∞ –Ω—É–∂–Ω–æ–µ –º–µ—Å—Ç–æ –≤ —Å—Ç—Ä–æ–∫–µ.




*/


static void DLLL() {
	HWND window = FindWindowA("ConsoleWindowClass", 0);
	if (window) {
		MessageBoxA(window, "injected", "", MB_OK | MB_ICONMASK);
		DWORD pid = {};
		GetWindowThreadProcessId(window, &pid);

		if (pid != 0) {
			HANDLE process = OpenProcess(PROCESS_ALL_ACCESS, FALSE, pid);
			DWORD temp;
			SIZE_T read;
			uintptr_t address = 0x00000049CADAFB84;
			ReadProcessMemory(process, reinterpret_cast<LPVOID>(address), &temp, sizeof(temp), &read);
			wchar_t buffer[64];
			swprintf_s(buffer, L"–ó–Ω–∞—á–µ–Ω–∏–µ: %u", temp);
			MessageBoxW(NULL, buffer, L"–†–µ–∑—É–ª—å—Ç–∞—Ç", MB_OK);
		}

	}
}

bool __stdcall DllMain(void* Module, unsigned long reason, void* reserved) {
	switch (reason) {
	case DLL_PROCESS_ATTACH:
		CreateThread(0, 0, reinterpret_cast<LPTHREAD_START_ROUTINE>(DLLL), 0, 0, 0);
		break;
	}
	return true;
}
